$(function(){function rename(e){console.log(e);e.stopPropagation();console.log(e.target);console.log(target);var $elem=$(target).parents("li.list-drag").find(".dsg-myData");$elem.hide();$(target).parents("li.list-drag").find(".drag-rename").show().find(".text").val($elem.text());$(".sure").on("click",function(e){e.stopPropagation();$(this).parent(".drag-rename").hide();var cc=$(this).parent(".drag-rename").find(".text").val();$(this).parent().parent().children().children(".dsg-myData").html(cc).show()})}function deleteData(e){console.log(target);$(target).parents("li.list-drag").remove()}function publicRename(e){var $a=$(target).parents(".group-item");$a.hide();$a.siblings(".group-item-form").show().find(".group-item-txt").val($a.find(".drag-content").html());$(".list-sure").on("click",function(e){e.stopPropagation();var form=$(this).parent(".group-item-form");form.hide();var val_1=form.find(".group-item-txt").val();form.siblings(".group-item").show();form.siblings(".group-item").find(".drag-content").html(val_1)})}function publicDel(e){$(target).parents("li.group-second-body").remove()}$(".title-remove").on("click",function(){$(".edit").hide(1000)});function parameter(e){$(target).parents("body").find(".edit").show(1000)}var btn_,target;function handleClick(e,menuHtml){var ck;if(target){$(target).attr("ck",true)}$(btn_).remove();var xx=e.pageX;var yy=e.pageY;if($(e.target).attr("ck")){ck=$(e.target).attr("ck")}else{ck=true}console.log(ck);if(ck){btn_=$(menuHtml);btn_.css({"position":"absolute","top":(yy+5)+"px","left":xx+"px"});$("body").append(btn_);$(".item-rename").bind("click",rename);$(".item-delete").bind("click",deleteData);$(".dimension-rename").bind("click",publicRename);$(".mensure-rename").bind("click",publicRename);$(".dimension-delete").bind("click",publicDel);$(".mensure-delete").bind("click",publicDel);$(".creat-parameter-filed").bind("click",parameter);target=e.target;ck=false}else{$(".list-down").remove();ck=true}$(e.target).attr("ck",ck);e.stopPropagation()}var menu1='<ul class="list-down">'+'<li><a href="#" class="item-rename">'+'<span class="glyphicon glyphicon-pencil">&nbsp;</span>重命名</a></li>'+'<li><a href="#" class="item-delete">'+'<span class="glyphicon glyphicon-trash">&nbsp;</span>删除</a></li>'+"</ul>";var menu2='<ul class="list-down">'+'<li><a href="#" class="creat-count-field" onclick="">创建计算字段</a></li>'+'<li><a href="#" class="creat-parameter-filed" onclick="">创建参数字段</a></li>'+"</ul>";var menu3='<ul class="list-down">'+'<li><a href="#" class="dimension-rename" onclick="">'+'<span class="glyphicon glyphicon-pencil">&nbsp;</span>重命名</a></li>'+'<li><a href="#" class="dimension-change" onclick="">'+'<span class="glyphicon glyphicon-refresh">&nbsp;</span>转化为度量</a></li>'+'<li><a href="#" class="dimension-delete" onclick="">'+'<span class="glyphicon glyphicon-trash">&nbsp;</span>删除</a></li>'+"</ul>";var menu4='<ul class="list-down">'+'<li><a href="#" class="creat-count-field" onclick="">创建计算字段</a></li>'+"</ul>";var menu5='<ul class="list-down">'+'<li><a href="#" class="mensure-rename" onclick="">'+'<span class="glyphicon glyphicon-pencil">&nbsp;</span>重命名</a></li>'+'<li><a href="#" class="mensure-change" onclick="">'+'<span class="glyphicon glyphicon-refresh">&nbsp;</span>转化为维度</a></li>'+'<li><a href="#" class="mensure-delete" onclick="">'+'<span class="glyphicon glyphicon-trash">&nbsp;</span>删除</a></li>'+"</ul>";function creat(){$(".data-down").on("click",function(e){handleClick(e,menu1)});$(".dimension-down").on("click",function(e){handleClick(e,menu2)});$(".downList").on("click",function(e){handleClick(e,menu3)});$(".measure-down").on("click",function(e){handleClick(e,menu4)});$(".measure-downList").on("click",function(e){handleClick(e,menu5)});$("body").on("click",function(){if(target){$(target).attr("ck",true)}$(btn_).remove()})}creat();var option={title:{text:"某地区蒸发量和降水量",subtext:"纯属虚构"},tooltip:{trigger:"axis"},legend:{data:["维度","量度"]},toolbox:{show:true,feature:{dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar","pie","radar"]},restore:{show:true},saveAsImage:{show:true}}},calculable:true,xAxis:[{type:"category",name:"维度",axisLIne:{show:true,lineStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"red"},{offset:1,color:"blue"}],false)}},axisTick:{show:false}}],yAxis:[{type:"value"}],series:[{name:"维度",type:"bar",markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},itemStyle:{normal:{color:function(params){var colorList=["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"];return colorList[params.dataIndex]},}},markLine:{data:[{type:"average",name:"平均值"}],lineStyle:{normal:{color:"red"}}}}]};function showChart(){var myChart=echarts.init(document.getElementById("show"));var r=$(".row-view .ui-draggable-handle");var r1=$(".list-view .ui-draggable-handle");var data=$.ajax("../json/chart.json").done(function(data){console.log(r.length,r1.length);
    if(data.code==200){if(r.length>0){option.title.text=data.title;option.xAxis[0].data=data.dimension}else{option.xAxis[0].data=[]}if(r1.length>0){option.series[0].data=data.metric}else{option.series[0].data=[0,0,0,0,0,0,0,0,0,0,0,0];option.xAxis[0].data=data.dimension}myChart.setOption(option);if(r.length==0&&r1.length==0){$(".drag-content").draggable({"disabled":false});$(".drag-show-view").hide();$(".analyseResult").show();$("#freqently>div").css({"background":"#F2F2F2"})}else{$(".analyseResult").hide();$(".drag-show-view").show();$("#freqently>div").css({"background":"#F2F2F2"})}}})}function changeBar(){var myChart=echarts.init(document.getElementById("show"));var r=$(".row-view .ui-draggable-handle");var r1=$(".list-view .ui-draggable-handle");var data=$.ajax("../json/chart.json").done(function(data){console.log(r.length,r1.length);if(data.code==200){if(r.length>0){option.title.text=data.title;option.xAxis[0].type="value";option.yAxis[0].type="category";option.yAxis[0].data=data.dimension}else{option.yAxis[0].data=[]}if(r1.length>0){option.series[0].data=data.metric}else{option.series[0].data=[0,0,0,0,0,0,0,0,0,0,0,0];option.xAxis[0].data=data.dimension}myChart.setOption(option);if(r.length==0&&r1.length==0){$(".drag-content").draggable({"disabled":false});$(".drag-show-view").hide();$(".analyseResult").show();$("#freqently>div").css({"background":"#F2F2F2"})}else{$(".analyseResult").hide();$(".drag-show-view").show()}}})}$("#changeBar").on("click",function(){changeBar()});$("#pie").on("click",function(){var myChart=echarts.init(document.getElementById("show"));var r=$(".row-view .ui-draggable-handle");var r1=$(".list-view .ui-draggable-handle");var data=$.ajax("../json/chart.json").done(function(data){var option={title:{text:"某站点用户访问来源",subtext:"纯属虚构",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:["直接访问","邮件营销","联盟广告","视频广告","搜索引擎"]},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:335,name:"直接访问"},{value:310,name:"邮件营销"},{value:234,name:"联盟广告"},{value:135,name:"视频广告"},{value:1548,name:"搜索引擎"}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"},normal:{color:function(params){var colorList=["#C1232B","#B5C334","#FCCE10","#E87C25","#27727B","#FE8463","#9BCA63","#FAD860","#F3A43B","#60C0DD","#D7504B","#C6E579","#F4E001","#F0805A","#26C0C0"];return colorList[params.dataIndex]},label:{show:true,position:"top",formatter:"{b}\n{c}"}}}}]};if(data.code==200){var data=data;option.title.text=data.title;option.tooltip.trigger=data.trigger;option.legend.data=data.dimension;option.series[0].data=[];for(var i=0;i<data.metric.length;i++){option.series[0].data.push({value:data.metric[i],name:data.dimension[i]})}myChart.setOption(option);if(r.length==0&&r1.length==0){$(".drag-content").draggable({"disabled":false});$(".drag-show-view").hide();$(".analyseResult").show();$("#freqently>div").css({"background":"#F2F2F2"})}else{$(".analyseResult").hide();$(".drag-show-view").show()}}})});$("#line").on("click",function(){var myChart=echarts.init(document.getElementById("show"));var r=$(".row-view .ui-draggable-handle");var r1=$(".list-view .ui-draggable-handle");var data=$.ajax("../json/chart.json").done(function(data){var option={title:{text:data.title},tooltip:{trigger:"axis"},legend:{data:["维度"]},toolbox:{show:true,feature:{dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar","pie","radar"]},restore:{show:true},saveAsImage:{show:true}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:true},xAxis:{type:"category",boundaryGap:false,data:data.dimension},yAxis:{type:"value"},series:[{name:"维度",type:"line",stack:"总量",data:data.metric}]};if(data.code==200){if(r.length>0){}else{}if(r1.length>0){}else{}myChart.setOption(option);if(r.length==0&&r1.length==0){$(".drag-content").draggable({"disabled":false});$(".drag-show-view").hide();$(".analyseResult").show();$("#freqently>div").css({"background":"#F2F2F2"})}else{$(".analyseResult").hide();$(".drag-show-view").show()}}})});$("#stepLine").on("click",function(){var myChart=echarts.init(document.getElementById("show"));var r=$(".row-view .ui-draggable-handle");var r1=$(".list-view .ui-draggable-handle");var data=$.ajax("../json/chart.json").done(function(data){var option={title:{text:data.title},tooltip:{trigger:"axis"},legend:{data:["Step Start"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:true},toolbox:{show:true,feature:{dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar","pie","radar"]},restore:{show:true},saveAsImage:{show:true}}},xAxis:{type:"category",data:data.dimension},yAxis:{type:"value"},series:[{name:"Step Start",type:"line",step:"start",data:data.metric}]};if(data.code==200){if(r.length>0){}else{}if(r1.length>0){}else{}myChart.setOption(option);if(r.length==0&&r1.length==0){$(".drag-content").draggable({"disabled":false});$(".drag-show-view").hide();$(".analyseResult").show();$("#freqently>div").css({"background":"#F2F2F2"})
}else{$(".analyseResult").hide();$(".drag-show-view").show()}}})});$("#bar").on("click",function(){var myChart=echarts.init(document.getElementById("show"));var r=$(".row-view .ui-draggable-handle");var r1=$(".list-view .ui-draggable-handle");var data=$.ajax("../json/chart.json").done(function(data){console.log(r.length,r1.length);if(data.code==200){if(r.length>0){option.title.text=data.title;option.yAxis[0].type="value";option.xAxis[0].type="category";option.xAxis[0].data=data.dimension}else{option.xAxis[0].data=[]}if(r1.length>0){option.series[0].data=data.metric}else{option.series[0].data=[0,0,0,0,0,0,0,0,0,0,0,0];option.xAxis[0].data=data.dimension}myChart.setOption(option);if(r.length==0&&r1.length==0){$(".drag-content").draggable({"disabled":false});$(".drag-show-view").hide();$(".analyseResult").show();$("#freqently>div").css({"background":"#F2F2F2"})}else{$(".analyseResult").hide();$(".drag-show-view").show()}}})});$(".drag-content").draggable({cursor:"move",revert:"invalid",helper:function(obj){$(".row-content").css("border","1px dashed blue");var txt=obj.target.firstChild.data;return"<div class='move' style='opacity: 0;'>"+txt+"</div>"},start:function(event,ui){$(this).parents(".list-drag").siblings().children(".drag-content").draggable({"disabled":true});$(ui.helper).css({"text-overflow":"inherit","width":"outo"});$(this).parents(".list-drag").siblings().find("li .drag-content").draggable({"disabled":true});var x=event.pageX;var y=event.pageY;console.log(x,y);console.log($(this).html());var btn_=$('<div class="move"></div>');btn_.html($(this).html());btn_.css({"position":"absolute","top":(y-15)+"px","left":(x-75)+"px"});$("body").append(btn_)},drag:function(e,ui){e.stopPropagation();var x=event.pageX;var y=event.pageY;$(".move").css({"position":"absolute","top":(y-15)+"px","left":(x-75)+"px"})},stop:function(event,ui){$(".move").remove()}});$(".row-view").droppable({activeClass:"active",hoverClass:"hover",drop:function(event,ui){var helper=ui.helper;console.log(helper);var cc=helper[0];var cc1=$(cc).clone().removeAttr("class").removeAttr("style").addClass("dropMove");$(cc1).appendTo(".row-view");$(cc1).draggable({cursor:"move",start:function(event,ui){$(this).css({"z-index":"1000","opacity":0});var x=event.pageX;var y=event.pageY;console.log(x,y);console.log($(this).html());var btn_=$('<div class="dropDrag"></div>');btn_.html($(this).html());btn_.css({"position":"absolute","top":(y-15)+"px","left":(x-75)+"px"});$("body").append(btn_)},drag:function(e,ui){e.stopPropagation();$(this).css({"position":"absolute","z-index":100000});var x=e.pageX;var y=e.pageY;$(".dropDrag").css({"position":"absolute","top":(y-13)+"px","left":(x-50)+"px"});$(".list-view").css({"height":"30px"})},stop:function(event,ui){$(ui.helper[0]).remove();$(".dropDrag").remove();showChart()}});showChart()},activate:function(event,ui){},create:function(event,ui){},deactivate:function(event,ui){$(".row-content").css("border","1px dashed #ddd")},out:function(event,ui){},over:function(event,ui){var rowL=$(".row-view .ui-draggable-handle").length;if(rowL<1){$(".row-view").css({"height":"30px"})}else{if(rowL>3){$(".row-view").css({"height":"auto","z-index":1000})}}},tolerance:"touch"});$(".list-view").droppable({activeClass:"active",hoverClass:"hover",drop:function(event,ui){var helper=ui.helper;var cc=helper[0];var cc1=$(cc).clone().removeAttr("class").removeAttr("style").addClass("dropMove");$(cc1).appendTo(".list-view");$(cc1).draggable({cursor:"move",start:function(event,ui){$(this.target).css({"z-index":"1000","opacity":0});var x=event.pageX;var y=event.pageY;console.log(x,y);console.log($(this).html());var btn_=$('<div class="dropDrag"></div>');btn_.html($(this).html());btn_.css({"position":"absolute","top":(y-15)+"px","left":(x-75)+"px"});$("body").append(btn_);$(".list-view").css({"height":"30px"})},drag:function(e,ui){e.stopPropagation();$(this).css({"position":"absolute","z-index":100000});var x=e.pageX;var y=e.pageY;$(".dropDrag").css({"position":"absolute","top":(y-13)+"px","left":(x-50)+"px"})},stop:function(event,ui){$(ui.helper[0]).remove();$(".dropDrag").remove();showChart()}});showChart()},activate:function(event,ui){},create:function(event,ui){},deactivate:function(event,ui){},out:function(event,ui){},over:function(event,ui){var listL=$(".list-view .ui-draggable-handle").length;if(listL<1){$(".list-view").css({"height":"30px"})}else{if(listL>3){$(".list-view").css({"height":"auto","z-index":1000})}}},tolerance:"touch"});$(".row-view").mouseover(function(){var rowL=$(".row-view .ui-draggable-handle").length;if(rowL<1){$(".row-view").css({"height":"30px"})}else{if(rowL>3){$(".row-view").css({"height":"auto","z-index":1000})}}}).mouseout(function(){$(this).css({"height":"30px"})});$(".list-view").mouseover(function(){var listL=$(".row-view .ui-draggable-handle").length;if(listL<1){$(this).css({"height":"30px"})}else{if(listL>3){$(this).css({"height":"auto","z-index":1000})}}}).mouseout(function(){$(this).css({"height":"30px"})
})});function echart(){var myChart=echarts.init(document.getElementById("show"));option={title:{text:"某地区蒸发量和降水量",subtext:"纯属虚构"},tooltip:{trigger:"axis"},legend:{data:["维度","量度"]},toolbox:{show:true,feature:{dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},dataZoom:[{type:"slider",show:true,start:0,end:100,handleSize:8}],calculable:true,xAxis:[{type:"category",data:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]}],yAxis:[{type:"value"}],series:[{name:"维度",type:"bar",data:[2,4.9,7,23.2,25.6,76.7,135.6,162.2,32.6,20,6.4,3.3],markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{name:"量度",type:"bar",data:[2.6,5.9,9,26.4,28.7,70.7,175.6,182.2,48.7,18.8,6,2.3],markPoint:{data:[{name:"年最高",value:182.2,xAxis:7,yAxis:183},{name:"年最低",value:2.3,xAxis:11,yAxis:3}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};myChart.setOption(option)};